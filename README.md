# LangMark

A set of micro-benchmarks comparing functional (immutable) and imperative (in-place) implementations across different programming languages.

## Languages

Currently implemented in:
- **C++** (compiled with `-O3 -march=native`)
- **Go** (compiled)
- **JavaScript/Node.js** (interpreted)
- **OCaml** (compiled with `ocamlopt`)
- **Python** (interpreted)
- **Rust** (compiled with `-C opt-level=3 -C target-cpu=native`)
- **V** (compiled with `-prod`)

## Implementation Variants

Each language has two implementations:
- **`immutable.*`** - Functional approach creating new arrays
- **`in_place.*`** - Imperative approach modifying arrays in-place

## Quick Start

### Prerequisites

Install Nix and enter the development shell:
```bash
nix-shell
```

### Running Benchmarks

Run all implementations and compare performance:
```bash
v run benchmark.v
```

### Running Individual Implementations

```bash
# Python
python3 immutable.py
python3 in_place.py

# Go
go run immutable.go
go run in_place.go

# V
v run immutable.v
v run in_place.v

# C++ (compile first)
g++ -O3 -march=native -o immutable_cpp immutable.cpp && ./immutable_cpp
g++ -O3 -march=native -o in_place_cpp in_place.cpp && ./in_place_cpp
```

## Command-Line Flags

All implementations support:
- **No flag**: Print first 10 elements of sorted array
- **`-v`**: Verbose mode - print entire sorted array
- **`-p`**: Pre-print mode - print unsorted array and exit (for verification)

Examples:
```bash
python3 immutable.py        # Shows first 10 sorted elements
python3 immutable.py -v     # Shows entire sorted array
python3 immutable.py -p     # Shows unsorted input array
```

### Benchmark with Flags

Pass flags to all variants through the benchmark:
```bash
v run benchmark.v -v    # All variants run in verbose mode
v run benchmark.v -p    # All variants pre-print input
```

## Test Data

All implementations sort the same 10,000-element array generated by:
```
array[i] = (i * 73 + 19) % 10000
```

This ensures consistent comparison across languages.

## Benchmark Details

- Runs each implementation 10 times
- Reports best and worst execution times
- Results sorted by performance
- Compiled binaries stored in `build/` directory

## Adding More Languages

See [AGENTS.md](AGENTS.md) for detailed instructions on implementing quicksort in additional languages.

## Project Structure

```
.
├── immutable.*      # Functional implementations
├── in_place.*       # Imperative implementations
├── benchmark.v      # Benchmark runner
├── shell.nix        # Nix development environment
├── build/           # Compiled binaries (generated)
├── AGENTS.md        # Implementation guide
└── README.md        # This file
```
